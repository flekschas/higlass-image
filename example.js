!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="./",i(i.s=0)}([function(e,t,i){"use strict";i.r(t),window.higlassTracks=window.higlassTracks||{},window.higlassTracksByType=window.higlassTracksByType||{};var n=e=>{window.higlassTracks[e.name]=e,window.higlassTracksByType[e.config.type]=e};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t,i){return(r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,i){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return i&&u(o,i.prototype),o}).apply(null,arguments)}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,i){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(i):o.value}})(e,t,i||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f=function e(t){if(!(this instanceof e?this.constructor:void 0))throw new Error('Uncaught TypeError: Class constructor cannot be invoked without "new"');for(var i=t.libraries.PIXI,n=t.factories.DataFetcher,f=t.services,m=f.pubSub,d=f.tileProxy,p=t.utils,v=p.debounce,y=p.trimTrailingSlash,T=t.configs.ZOOM_DEBOUNCE,b=function(e){function r(e,t){var i,s,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),s=this,a=c(r).call(this,e,t),i=!a||"object"!==o(a)&&"function"!=typeof a?h(s):a;var l=e.dataConfig,u=e.handleTilesetInfoReceived,f=e.animate;i.visibleTiles=new Set,i.visibleTileIds=new Set,i.fetching=new Set,i.fetchedTiles={},i.tileGraphics={},i.options=i.options||{};var d=i.options.minXPos?+i.options.minXPos:0,p=i.options.minYPos?+i.options.minYPos:0,b=i.options.maxXPos?+i.options.maxXPos:312e7,g=i.options.maxYPos?+i.options.maxYPos:312e7;return i.minPos=[d,p],i.maxPos=[b,g],i.maxZoom=i.options.maxZoom?+i.options.maxZoom:19,i.maxWidth=b,i.maxHeight=g,i.animate=f,i.refreshTilesDebounced=v(i.refreshTiles.bind(h(h(i))),T),i.dataConfig=l,i.tileSource="".concat(y(l.server),"/tiles/?d=").concat(l.tilesetUid),i.dataFetcher=new n(l,m),i.dataFetcher.tilesetInfo(function(e){if(i.tilesetInfo=e,"error"in i.tilesetInfo)return console.warn("Error retrieving tilesetInfo:",l,i.tilesetInfo.error),i.error=i.tilesetInfo.error,i.tilesetInfo=null,i.draw(),void i.animate();i.maxZoom=+i.tilesetInfo.max_zoom,i.maxWidth=+i.tilesetInfo.max_size,i.maxHeight=+i.tilesetInfo.max_size,i.maxDim=Math.max(i.maxWidth,i.maxHeight),b=i.options.maxXPos||+i.tilesetInfo.max_size,g=i.options.maxYPos||+i.tilesetInfo.max_size,i.maxPos=[b,g],i.options&&i.options.maxZoom&&(i.options.maxZoom>=0?i.maxZoom=Math.min(i.options.maxZoom,i.maxZoom):console.error("Invalid maxZoom on track:",h(h(i)))),i.refreshTiles(),u&&u(e),i.options.name=i.options.name?i.options.name:e.name,i.draw(),i.animate()}),i}var f,p,b;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(r,t.tracks.PixiTrack),f=r,(p=[{key:"addMissingGraphics",value:function(){for(var e=Object.keys(this.fetchedTiles),t=0;t<e.length;t++)if(!(e[t]in this.tileGraphics)){var n=new i.Graphics;this.pMain.addChild(n),this.fetchedTiles[e[t]].graphics=n,this.initTile(this.fetchedTiles[e[t]]),this.tileGraphics[e[t]]=n}}},{key:"areAllVisibleTilesLoaded",value:function(){var e=new Set(Object.keys(this.fetchedTiles));return s(this.visibleTileIds).every(function(t){return e.has(t)})}},{key:"calculateZoomLevel",value:function(){var e=d.calculateZoomLevel(this._xScale,this.minPos[0],this.maxPos[0]),t=d.calculateZoomLevel(this._xScale,this.minPos[1],this.maxPos[1]),i=Math.min(Math.max(e,t),this.maxZoom);return this.options&&this.options.maxZoom&&(this.options.maxZoom>=0?i=Math.min(this.options.maxZoom,i):console.error("Invalid maxZoom on track:",this)),i}},{key:"calculateVisibleTiles",value:function(){if(this.tilesetInfo){this.zoomLevel=this.calculateZoomLevel(),this.xTiles=d.calculateTiles(this.zoomLevel,this._xScale,this.minPos[0],this.maxPos[0],this.maxZoom,this.maxDim),this.yTiles=d.calculateTiles(this.zoomLevel,this._yScale,this.minPos[1],this.maxPos[1],this.maxZoom,this.maxDim);for(var e=this.yTiles,t=this.xTiles,i=this.zoomLevel,n=[],o=0;o<e.length;o++)for(var r=0;r<t.length;r++){var s=[i,e[o],t[r]];n.push(s)}this.setVisibleTiles(n)}}},{key:"destroyTile",value:function(e){e.graphics.destroy(),e.sprite=void 0,e.tileData=void 0}},{key:"draw",value:function(){this.delayDrawing||l(c(r.prototype),"draw",this).call(this)}},{key:"fetchNewTiles",value:function(e){var t=this;e.length>0&&s(new Set(e.map(function(e){return e.remoteId}))).forEach(function(e){var i=e.split("."),n="".concat(t.tileSource,".").concat(e,"&raw=1"),o=new Image;o.crossOrigin="Anonymous",o.src=n,o.onload=function(){var r={};r[e]={tileId:e,img:o,zoomLevel:+i[0],tilePos:[+i[1],+i[2]],tileSrc:n},t.receivedTiles(r)}})}},{key:"getTilePosAndDimensions",value:function(e,t){var i=t[1],n=t[0],o=this.maxPos[0]-this.minPos[0],r=this.maxPos[0]-this.minPos[0],s=o/Math.pow(2,e),a=r/Math.pow(2,e);return{tileX:0+i*s,tileY:0+n*a,tileWidth:s,tileHeight:a}}},{key:"initTile",value:function(e){var t=new i.Texture(new i.BaseTexture(e.tileData.img)),n=new i.Sprite(t),o=e.graphics;e.sprite=n,this.setSpriteProperties(e.sprite,e.tileData.zoomLevel,e.tileData.tilePos),o.removeChildren(),o.addChild(e.sprite)}},{key:"minValue",value:function(e){return e&&(this.scale.minValue=e),this.scale.minValue}},{key:"maxValue",value:function(e){return e&&(this.scale.maxValue=e),this.scale.maxValue}},{key:"minRawValue",value:function(){return this.scale.minRawValue}},{key:"maxRawValue",value:function(){return this.scale.maxRawValue}},{key:"receivedTiles",value:function(e){var t=this;this.visibleTiles.filter(function(t){return e[t.remoteId]}).forEach(function(i){t.fetchedTiles[i.tileId]||(t.fetchedTiles[i.tileId]=i),t.fetchedTiles[i.tileId].tileData=e[i.remoteId]}),Object.keys(e).forEach(function(i){e[i]&&t.fetching.has(i)&&t.fetching.delete(i)}),this.synchronizeTilesAndGraphics(),this.refreshTiles(),this.draw(),this.animate()}},{key:"refreshTiles",value:function(){var e=this;this.calculateVisibleTiles();for(var t=new Set(Object.keys(this.fetchedTiles)),i=s(this.visibleTiles).filter(function(i){return!e.fetching.has(i.remoteId)&&!t.has(i.tileId)}),n=0;n<i.length;n++)this.fetching.add(i[n].remoteId);var o=s(t).filter(function(t){return!e.visibleTileIds.has(t)});this.removeTiles(o),this.fetchNewTiles(i)}},{key:"refScalesChanged",value:function(e,t){var i=this;l(c(r.prototype),"refScalesChanged",this).call(this,e,t),Object.keys(this.fetchedTiles).map(function(e){return i.fetchedTiles[e]}).filter(function(e){return e.sprite}).forEach(function(e){i.setSpriteProperties(e.sprite,e.tileData.zoomLevel,e.tileData.tilePos)})}},{key:"removeAllTiles",value:function(){var e=new Set(Object.keys(this.fetchedTiles));this.removeTiles(s(e))}},{key:"removeTiles",value:function(e){var t=this;e.length&&this.areAllVisibleTilesLoaded()&&(e.forEach(function(e){var i=e;t.destroyTile(t.fetchedTiles[i]),i in t.tileGraphics&&(t.pMain.removeChild(t.tileGraphics[i]),delete t.tileGraphics[i]),delete t.fetchedTiles[i]}),this.synchronizeTilesAndGraphics(),this.draw())}},{key:"setSpriteProperties",value:function(e,t,i){var n=this.getTilePosAndDimensions(t,i),o=n.tileX,r=n.tileY,s=n.tileWidth,a=n.tileHeight;e.x=this._refXScale(o),e.y=this._refYScale(r);var l=o+s,c=r+a;e.width=this._refXScale(l)-this._refXScale(o),e.height=this._refYScale(c)-this._refYScale(r)}},{key:"setVisibleTiles",value:function(e){var t=this;this.visibleTiles=e.map(function(e){return{tileId:t.tileToLocalId(e),remoteId:t.tileToRemoteId(e),mirrored:e.mirrored}}),this.visibleTileIds=new Set(this.visibleTiles.map(function(e){return e.tileId}))}},{key:"synchronizeTilesAndGraphics",value:function(){this.addMissingGraphics()}},{key:"tileToLocalId",value:function(e){return e.join(".")}},{key:"tileToRemoteId",value:function(e){return e.join(".")}},{key:"visibleAndFetchedIds",value:function(){var e=this;return Object.keys(this.fetchedTiles).filter(function(t){return e.visibleTileIds.has(t)})}},{key:"visibleAndFetchedTiles",value:function(){var e=this;return this.visibleAndFetchedIds().map(function(t){return e.fetchedTiles[t]})}},{key:"zoomed",value:function(e,t,i,n,o){l(c(r.prototype),"zoomed",this).call(this,e,t),this.xScale(e),this.yScale(t),this.pMain.position.x=n,this.pMain.position.y=o,this.pMain.scale.x=i,this.pMain.scale.y=i,this.refreshTilesDebounced()}}])&&a(f.prototype,p),b&&a(f,b),r}(),g=arguments.length,x=new Array(g>1?g-1:0),w=1;w<g;w++)x[w-1]=arguments[w];return r(b,x)},m=new DOMParser;f.config={type:"image-tiles",datatype:["image-tiles"],local:!0,orientation:"2d",hidden:!0,name:"Image Tiles",thumbnail:m.parseFromString('<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="1.5"><path d="M9.5 10L12 7.5l3.5 3.5M.5 12L6 6l4.583 5.5" fill="none" stroke="currentColor"/><path d="M16 14H0V2h16v12zM1 3v10h14V3H1z" fill="currentColor"/><circle cx="9.5" cy="5.5" r="1" fill="none" stroke="currentColor"/></svg>',"text/xml").documentElement},f.version="0.2.0",f.dependencies={higlass:"1.5.7"};var d=f;n({name:"TiledImageTrack",track:d,config:d.config});var p=d;t.default=p}]);